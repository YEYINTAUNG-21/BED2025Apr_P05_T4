<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>System Error Logs</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  
  <!-- Custom Styles -->
  <link rel="stylesheet" href="error_logs_style.css">
</head>

<body>
  <nav class="navbar navbar-expand-lg custom-navbar">
    <div class="container-fluid px-4 d-flex justify-content-between align-items-center">

      <a href="index.html" class="d-flex align-items-center">
        <img src="Images/Lion_Befrienders_Logo.png" class="logo me-3" alt="Lion Befrienders Logo" />
      </a>

      <div id="links" class="d-flex justify-content-center gap-4 flex-grow-1">
        <a class="nav-link fw-semibold" href="doctor.html">Doctors</a>
        <a class="nav-link fw-semibold" href="appointment.html">Appointments</a>
      </div>

      <div class="profile-icon d-flex align-items-center">
        <img src="Images/Login_User_Avatar.png" alt="Profile Icon" class="profile-img" />
      </div>

    </div>
  </nav>





<!-- Table -->
<div class="container mt-3">
  <div class="record-table border rounded shadow-sm">
    <table class="table table-bordered table-sm mb-0">
      <thead class="text-center table-head">
        <tr>
          <th>No.</th>
          <th>Error</th>
          <th>Reason</th>
          <th>Date</th>
          <th>Actions Taken</th>
        </tr>
      </thead>
      <tbody id="records-body">
        <!-- Sample Row -->
        <tr class="record-row text-center" data-bs-toggle="modal" data-bs-target="#recordModal"
          onclick="showDetails({
            id: 1,
            system_error: 'Database connection failed',
            reason: 'Incorrect credentials',
            date_encountered: '2025-07-28',
            actions_taken: 'Checked .env file, fixed password'
          })">
          <td>1</td>
          <td>Database connection failed</td>
          <td>Incorrect credentials</td>
          <td>28/07/2025</td>
          <td class="text-truncate" style="max-width: 150px;">Checked .env file, fixed password</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="recordModal" tabindex="-1" aria-labelledby="recordModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="recordModalLabel">Error Log Details</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="modal-body">
        <!-- Dynamic content -->
      </div>
      <div class="modal-footer justify-content-end">
        <button class="btn btn-outline-success btn-sm" onclick="updateAction()">Update</button>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
let currentRecord = null;

function showDetails(record) {
  currentRecord = record;

  const modalBody = document.getElementById("modal-body");
  modalBody.innerHTML = `
    <p><strong>Error:</strong> ${record.system_error}</p>
    <p><strong>Reason:</strong> ${record.reason}</p>
    <p><strong>Date Encountered:</strong> ${new Date(record.date_encountered).toLocaleDateString()}</p>
    <label for="actionsTaken"><strong>Actions Taken:</strong></label>
    <textarea id="actionsTaken" class="form-control mt-1" rows="3">${record.actions_taken || ''}</textarea>
  `;
}

function updateAction() {
  const textarea = document.getElementById("actionsTaken");
  if (!currentRecord) return;

  currentRecord.actions_taken = textarea.value;

  // Update DOM directly since this is static testing
  const rows = document.querySelectorAll(".record-row");
  rows.forEach(row => {
    if (row.children[0].innerText == currentRecord.id) {
      row.children[4].innerText = textarea.value;
    }
  });

  // Feedback style
  textarea.classList.add('bg-success', 'text-white');
  setTimeout(() => textarea.classList.remove('bg-success', 'text-white'), 1500);
}
</script>

</body>
</html>
