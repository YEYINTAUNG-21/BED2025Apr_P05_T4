<!DOCTYPE html>
<html lang="en">
<head>
 
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Medical History Records</title>
  
  <!-- Bootstrap -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <!-- Custom Styles -->
  <link rel="stylesheet" href="../CSS/medical_records_style.css">
</head>

<body>
  <!-- Top Navbar -->
  <nav class="navbar navbar-expand-lg custom-navbar">
    <div class="container-fluid px-4 d-flex justify-content-between align-items-center">
      
      <a href="index.html" class="d-flex align-items-center">
        <img src="Images/Lion_Befrienders_Logo.png" class="logo me-3" alt="Lion Befrienders Logo" />
      </a>


      <div id="links" class="d-flex justify-content-center gap-4 flex-grow-1">
        <a class="nav-link fw-semibold" href="doctor.html">Doctors</a>
        <a class="nav-link fw-semibold" href="appointment.html">Appointments</a>
      </div>

      <div class="profile-icon d-flex align-items-center">
        <img src="Images/Login_User_Avatar.png" alt="Profile Icon" class="profile-img" />
      </div>

    </div>
  </nav>

  <!-- Table -->
  <div class="container mt-3">
    <div class="record-table border rounded shadow-sm">
      <table class="table table-bordered table-sm mb-0">
        <thead class="text-center table-head">
          <tr>
            <th>No.</th>
            <th>Purpose of Visit</th>
            <th>Medication Received</th>
            <th>Date</th>
            <th>Remarks</th>
          </tr>
        </thead>
        <tbody id="records-body">
          <tr class="record-row text-center" data-bs-toggle="modal" data-bs-target="#recordModal"
      onclick="showDetails({
        purpose_of_visit: 'General Checkup',
        medication_received: 'Paracetamol',
        visit_date: '2025-07-10',
        remarks: 'Patient reported mild headaches and fatigue.'
      })">
    <td>1</td>
    <td>General Checkup</td>
    <td>Paracetamol</td>
    <td>10/07/2025</td>
    <td class="text-truncate" style="max-width: 150px;">Patient reported mild headaches and fatigue.</td>
  </tr>  
          <!-- Data loaded via JS -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Model -->
  <div class="modal fade" id="recordModal" tabindex="-1" aria-labelledby="recordModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title" id="recordModalLabel">Medical Record Details</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="modal-body">
          <!-- Dynamic content -->
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>


  <script>
  async function fetchRecords() {
    try {
      const res = await fetch('/api/medical-records');
      const data = await res.json();
      const tbody = document.getElementById('records-body');

      data.forEach((rec, index) => {
        const tr = document.createElement('tr');
        tr.className = 'record-row text-center';
        tr.setAttribute('data-bs-toggle', 'modal');
        tr.setAttribute('data-bs-target', '#recordModal');
        tr.onclick = () => showDetails(rec);

        tr.innerHTML = `
          <td>${index + 1}</td>
          <td>${rec.purpose_of_visit}</td>
          <td>${rec.medication_received || 'None'}</td>
          <td>${new Date(rec.visit_date).toLocaleDateString()}</td>
          <td class="text-truncate" style="max-width: 150px;">${rec.remarks || 'None'}</td>
        `;
        tbody.appendChild(tr);
      });
    } catch (error) {
      alert("Failed to load records.");
      console.error(error);
    }
  }

  
  function showDetails(record) {
    const modalBody = document.getElementById("modal-body");
    modalBody.innerHTML = `
      <p><strong>Purpose of Visit:</strong> ${record.purpose_of_visit}</p>
      <p><strong>Medication Received:</strong> ${record.medication_received || 'None'}</p>
      <p><strong>Date:</strong> ${new Date(record.visit_date).toLocaleDateString()}</p>
      <p><strong>Remarks:</strong> ${record.remarks || 'None'}</p>
    `;
  }


    window.onload = fetchRecords;
  </script>
</body>
</html>
