<!DOCTYPE html>
<html lang="en">
<head>
 
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Medical History Records</title>
  
  <!-- Bootstrap 5 CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <!-- Custom Styles -->
  <link rel="stylesheet" href="medical_records_style.css">
</head>

<body>
  <!-- Top Navbar -->
<nav class="navbar navbar-expand-lg bg-light border-bottom">
  <div class="container-fluid d-flex justify-content-between align-items-center">
    <a class="navbar-brand d-flex align-items-center gap-2" href="#">
      <img src="Images/Lion_Befrienders_Logo.png" alt="Logo" height="40"/>
      <span class="fw-bold fs-4">Medical Records</span>
    </a>
    <div class="d-flex align-items-center gap-4 me-2">
      <a class="nav-link" href="#">Home</a>
      <a class="nav-link" href="#">About</a>
      <a class="nav-link" href="#">Help</a>
      <a class="nav-link" href="#">Contact</a>
      <span class="nav-link fw-bold">üë§</span>
    </div>
  </div>
</nav>

  <!-- Green Header -->
  <div class="green-header">
    ‚Üê
  </div>

  <!-- Table -->
  <div class="container mt-3">
    <div class="record-table border rounded shadow-sm">
      <table class="table table-bordered table-sm mb-0">
        <thead class="text-center table-head">
          <tr>
            <th>No.</th>
            <th>Purpose of Visit</th>
            <th>Medication Received</th>
            <th>Date</th>
            <th>Remarks</th>
          </tr>
        </thead>
        <tbody id="records-body">
          <tr class="record-row text-center" data-bs-toggle="modal" data-bs-target="#recordModal"
      onclick="showDetails({
        purpose_of_visit: 'General Checkup',
        medication_received: 'Paracetamol',
        visit_date: '2025-07-10',
        remarks: 'Patient reported mild headaches and fatigue.'
      })">
    <td>1</td>
    <td>General Checkup</td>
    <td>Paracetamol</td>
    <td>10/07/2025</td>
    <td class="text-truncate" style="max-width: 150px;">Patient reported mild headaches and fatigue.</td>
  </tr>  
          <!-- Data loaded via JS -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="recordModal" tabindex="-1" aria-labelledby="recordModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title" id="recordModalLabel">Medical Record Details</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="modal-body">
          <!-- Dynamic content -->
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS + Axios -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <script>
    async function fetchRecords() {
      try {
        const res = await axios.get('http://localhost:3000/api/medical-records');
        const tbody = document.getElementById('records-body');
        res.data.forEach((rec, index) => {
          const tr = document.createElement('tr');
          tr.className = 'record-row text-center';
          tr.setAttribute('data-bs-toggle', 'modal');
          tr.setAttribute('data-bs-target', '#recordModal');
          tr.onclick = () => showDetails(rec);

          tr.innerHTML = `
            <td>${index + 1}</td>
            <td>${rec.purpose_of_visit}</td>
            <td>${rec.medication_received || 'None'}</td>
            <td>${new Date(rec.visit_date).toLocaleDateString()}</td>
            <td class="text-truncate" style="max-width: 150px;">${rec.remarks || 'None'}</td>
          `;
          tbody.appendChild(tr);
        });
      } catch (error) {
        alert("Failed to load records.");
        console.error(error);
      }
    }

    function showDetails(rec) {
      const modalBody = document.getElementById('modal-body');
      modalBody.innerHTML = `
        <p><strong>Purpose of Visit:</strong> ${rec.purpose_of_visit}</p>
        <p><strong>Medication Received:</strong> ${rec.medication_received || 'None'}</p>
        <p><strong>Date:</strong> ${new Date(rec.visit_date).toLocaleDateString()}</p>
        <p><strong>Remarks:</strong> ${rec.remarks || 'None'}</p>
      `;
    }

    window.onload = fetchRecords;
  </script>
</body>
</html>